<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hệ Thống Quản Lý Lương Đa Nhánh</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    .dashboard-page {
      padding: 20px;
    }
    
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .page-header h2 {
      font-size: 1.8rem;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .page-header h2 i {
      color: #4361ee;
    }
    
    .date-range-picker {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 15px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .date-range-picker:hover {
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stats-card {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      display: flex;
      align-items: center;
      position: relative;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      z-index: 1;
    }
    
    .stats-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .stats-card .card-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-right: 15px;
      flex-shrink: 0;
    }
    
    .stats-card.primary .card-icon {
      background-color: rgba(67, 97, 238, 0.1);
      color: #4361ee;
    }
    
    .stats-card.success .card-icon {
      background-color: rgba(75, 192, 192, 0.1);
      color: #4bc0c0;
    }
    
    .stats-card.warning .card-icon {
      background-color: rgba(255, 206, 86, 0.1);
      color: #ffce56;
    }
    
    .stats-card.danger .card-icon {
      background-color: rgba(255, 99, 132, 0.1);
      color: #ff6384;
    }
    
    .stats-card .card-info h3 {
      font-size: 1.8rem;
      margin-bottom: 5px;
      color: #2c3e50;
    }
    
    .stats-card .card-info p {
      color: #7f8c8d;
      font-size: 0.9rem;
    }
    
    .stats-card .card-bg {
      position: absolute;
      top: -20px;
      right: -20px;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      opacity: 0.1;
      z-index: -1;
    }
    
    .stats-card.primary .card-bg {
      background-color: #4361ee;
    }
    
    .stats-card.success .card-bg {
      background-color: #4bc0c0;
    }
    
    .stats-card.warning .card-bg {
      background-color: #ffce56;
    }
    
    .stats-card.danger .card-bg {
      background-color: #ff6384;
    }
    
    .dashboard-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 1200px) {
      .dashboard-row {
        grid-template-columns: 1fr;
      }
    }
    
    .card {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .card:hover {
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .card-header {
      padding: 20px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-header h3 {
      font-size: 1.2rem;
      color: #2c3e50;
    }
    
    .card-body {
      padding: 20px;
    }
    
    .chart-card {
      height: 350px;
    }
    
    .chart-card .card-body {
      height: calc(100% - 61px);
    }
    
    .top-members-card .card-header {
      padding-bottom: 15px;
    }
    
    .view-all {
      color: #4361ee;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .view-all:hover {
      text-decoration: underline;
    }
    
    .top-members-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .top-member-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    .top-member-item:hover {
      background-color: #f8f9fa;
    }
    
    .member-rank {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #f1f2f6;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #7f8c8d;
      flex-shrink: 0;
    }
    
    .top-member-item:nth-child(1) .member-rank {
      background-color: #ffd700;
      color: white;
    }
    
    .top-member-item:nth-child(2) .member-rank {
      background-color: #c0c0c0;
      color: white;
    }
    
    .top-member-item:nth-child(3) .member-rank {
      background-color: #cd7f32;
      color: white;
    }
    
    .member-info {
      flex: 1;
    }
    
    .member-name {
      font-weight: 500;
      color: #2c3e50;
      margin-bottom: 3px;
    }
    
    .member-stats {
      display: flex;
      gap: 15px;
      font-size: 0.8rem;
      color: #7f8c8d;
    }
    
    .member-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #4361ee;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
    }
    
    .activity-timeline {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .activity-day {
      font-weight: bold;
      color: #2c3e50;
      padding: 5px 0;
      border-bottom: 1px dashed #eee;
    }
    
    .activity-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    .activity-item:hover {
      background-color: #f8f9fa;
    }
    
    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
    }
    
    .activity-icon.paid {
      background-color: rgba(75, 192, 192, 0.1);
      color: #4bc0c0;
    }
    
    .activity-icon.pending {
      background-color: rgba(255, 206, 86, 0.1);
      color: #ffce56;
    }
    
    .activity-details {
      flex: 1;
    }
    
    .activity-title {
      font-weight: 500;
      color: #2c3e50;
      margin-bottom: 3px;
    }
    
    .activity-description {
      font-size: 0.8rem;
      color: #7f8c8d;
    }
    
    .activity-time {
      font-size: 0.8rem;
      color: #7f8c8d;
      white-space: nowrap;
    }
    
    .payment-status .card-body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: calc(100% - 61px);
    }
    
    .payment-legend {
      width: 100%;
      margin-top: 20px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    
    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 10px;
    }
    
    .legend-color.paid {
      background-color: #4bc0c0;
    }
    
    .legend-color.pending {
      background-color: #ffce56;
    }
    
    .legend-color.cancelled {
      background-color: #ff6384;
    }
    
    .legend-value {
      font-weight: bold;
      color: #2c3e50;
    }
    
    .chart-period-select {
      padding: 5px 10px;
      border-radius: 5px;
      border: 1px solid #eee;
      font-size: 0.9rem;
      cursor: pointer;
    }
    
    .chart-period-select:focus {
      outline: none;
      border-color: #4361ee;
    }
    </style>
</head>
<body>
    <div class="dashboard-page">
        <div class="page-header">
          <h2><i class="fas fa-tachometer-alt"></i> Dashboard Tổng Quan</h2>
          <div class="date-range-picker">
            <i class="fas fa-calendar-alt"></i>
            <span>21/06/2025 - 29/06/2025</span>
            <i class="fas fa-chevron-down"></i>
          </div>
        </div>
      
        <div class="stats-cards">
          <div class="stats-card primary">
            <div class="card-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="card-info">
              <h3 id="totalMembers">0</h3>
              <p>Tổng thành viên</p>
            </div>
            <div class="card-bg"></div>
          </div>
      
          <div class="stats-card success">
            <div class="card-icon">
              <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="card-info">
              <h3 id="totalSalary">0đ</h3>
              <p>Tổng lương</p>
            </div>
            <div class="card-bg"></div>
          </div>
      
          <div class="stats-card warning">
            <div class="card-icon">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="card-info">
              <h3 id="totalTasks">0</h3>
              <p>Tổng công việc</p>
            </div>
            <div class="card-bg"></div>
          </div>
      
          <div class="stats-card danger">
            <div class="card-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="card-info">
              <h3 id="pendingPayments">0</h3>
              <p>Chờ thanh toán</p>
            </div>
            <div class="card-bg"></div>
          </div>
        </div>
      
        <div class="dashboard-row">
          <div class="card chart-card">
            <div class="card-header">
              <h3>Biểu đồ lương theo ngày</h3>
              <select class="chart-period-select">
                <option value="7">7 ngày</option>
                <option value="14">14 ngày</option>
                <option value="30">30 ngày</option>
              </select>
            </div>
            <div class="card-body">
              <canvas id="salaryChart"></canvas>
            </div>
          </div>
      
          <div class="card top-members-card">
            <div class="card-header">
              <h3>Top thành viên</h3>
              <div class="view-all">Xem tất cả</div>
            </div>
            <div class="card-body">
              <div class="top-members-list" id="topMembersList">
                <!-- Data will be loaded here -->
              </div>
            </div>
          </div>
        </div>
      
        <div class="dashboard-row">
          <div class="card recent-activities">
            <div class="card-header">
              <h3>Hoạt động gần đây</h3>
            </div>
            <div class="card-body">
              <div class="activity-timeline" id="activityTimeline">
                <!-- Data will be loaded here -->
              </div>
            </div>
          </div>
      
          <div class="card payment-status">
            <div class="card-header">
              <h3>Trạng thái thanh toán</h3>
            </div>
            <div class="card-body">
              <canvas id="paymentChart"></canvas>
              <div class="payment-legend">
                <div class="legend-item">
                  <span class="legend-color paid"></span>
                  <span>Đã thanh toán</span>
                  <span class="legend-value" id="paidPercent">0%</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color pending"></span>
                  <span>Chờ xử lý</span>
                  <span class="legend-value" id="pendingPercent">0%</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color cancelled"></span>
                  <span>Đã hủy</span>
                  <span class="legend-value" id="cancelledPercent">0%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Load data based on selected branch
      const selectedBranch = localStorage.getItem('selectedBranch') || 'meiu';
      const dataFile = selectedBranch === 'meiu' ? '../data/meiu.json' : '../data/s02-lopers.json';
      
      fetch(dataFile)
        .then(response => response.json())
        .then(data => {
          updateDashboard(data);
          initCharts(data);
        })
        .catch(error => {
          console.error('Error loading data:', error);
        });
    
      function updateDashboard(data) {
        // Calculate totals
        let totalMembers = new Set();
        let totalSalary = 0;
        let totalTasks = 0;
        let pendingPayments = 0;
        
        Object.values(data).forEach(dayData => {
          dayData.forEach(member => {
            totalMembers.add(member.name);
            totalTasks += member.quantity;
            const amount = member.quantity * member.unitPrice;
            totalSalary += amount;
            if (member.status === "Chờ xử lý") pendingPayments += amount;
          });
        });
        
        // Update UI
        document.getElementById('totalMembers').textContent = totalMembers.size;
        document.getElementById('totalSalary').textContent = totalSalary.toLocaleString() + 'đ';
        document.getElementById('totalTasks').textContent = totalTasks.toLocaleString();
        document.getElementById('pendingPayments').textContent = pendingPayments.toLocaleString() + 'đ';
        
        // Update top members
        updateTopMembers(data);
        updateRecentActivities(data);
      }
      
      function updateTopMembers(data) {
        const memberMap = {};
        
        Object.values(data).forEach(dayData => {
          dayData.forEach(member => {
            if (!memberMap[member.name]) {
              memberMap[member.name] = {
                quantity: 0,
                amount: 0
              };
            }
            memberMap[member.name].quantity += member.quantity;
            memberMap[member.name].amount += member.quantity * member.unitPrice;
          });
        });
        
        const topMembers = Object.entries(memberMap)
          .sort((a, b) => b[1].amount - a[1].amount)
          .slice(0, 5);
        
        const topMembersList = document.getElementById('topMembersList');
        topMembersList.innerHTML = '';
        
        topMembers.forEach(([name, stats], index) => {
          const memberEl = document.createElement('div');
          memberEl.className = 'top-member-item';
          memberEl.innerHTML = `
            <div class="member-rank">${index + 1}</div>
            <div class="member-info">
              <div class="member-name">${name}</div>
              <div class="member-stats">
                <span>${stats.quantity} tasks</span>
                <span>${stats.amount.toLocaleString()}đ</span>
              </div>
            </div>
            <div class="member-avatar">
              ${name.charAt(0).toUpperCase()}
            </div>
          `;
          topMembersList.appendChild(memberEl);
        });
      }
      
      function updateRecentActivities(data) {
        const activityTimeline = document.getElementById('activityTimeline');
        activityTimeline.innerHTML = '';
        
        // Get last 5 days
        const days = Object.keys(data).sort().reverse().slice(0, 5);
        
        days.forEach(day => {
          const dayHeader = document.createElement('div');
          dayHeader.className = 'activity-day';
          dayHeader.textContent = day;
          activityTimeline.appendChild(dayHeader);
          
          data[day].slice(0, 3).forEach(member => {
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item';
            activityItem.innerHTML = `
              <div class="activity-icon ${member.status === 'Đã thanh toán' ? 'paid' : 'pending'}">
                <i class="fas fa-${member.status === 'Đã thanh toán' ? 'check-circle' : 'clock'}"></i>
              </div>
              <div class="activity-details">
                <div class="activity-title">${member.name}</div>
                <div class="activity-description">
                  ${member.quantity} tasks • ${(member.quantity * member.unitPrice).toLocaleString()}đ
                </div>
              </div>
              <div class="activity-time">${member.status}</div>
            `;
            activityTimeline.appendChild(activityItem);
          });
        });
      }
      
      function initCharts(data) {
        // Salary by day chart
        const days = Object.keys(data).sort();
        const dailyTotals = days.map(day => {
          return data[day].reduce((sum, member) => sum + (member.quantity * member.unitPrice), 0);
        });
        
        const ctx1 = document.getElementById('salaryChart').getContext('2d');
        new Chart(ctx1, {
          type: 'line',
          data: {
            labels: days,
            datasets: [{
              label: 'Tổng lương',
              data: dailyTotals,
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 2,
              tension: 0.4,
              fill: true
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.raw.toLocaleString() + 'đ';
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return value.toLocaleString() + 'đ';
                  }
                }
              }
            }
          }
        });
        
        // Payment status chart
        let paid = 0, pending = 0, cancelled = 0;
        Object.values(data).forEach(dayData => {
          dayData.forEach(member => {
            const amount = member.quantity * member.unitPrice;
            if (member.status === "Đã thanh toán") paid += amount;
            else if (member.status === "Chờ xử lý") pending += amount;
            else cancelled += amount;
          });
        });
        
        const total = paid + pending + cancelled;
        document.getElementById('paidPercent').textContent = Math.round(paid/total*100) + '%';
        document.getElementById('pendingPercent').textContent = Math.round(pending/total*100) + '%';
        document.getElementById('cancelledPercent').textContent = Math.round(cancelled/total*100) + '%';
        
        const ctx2 = document.getElementById('paymentChart').getContext('2d');
        new Chart(ctx2, {
          type: 'doughnut',
          data: {
            labels: ['Đã thanh toán', 'Chờ xử lý', 'Đã hủy'],
            datasets: [{
              data: [paid, pending, cancelled],
              backgroundColor: [
                'rgba(75, 192, 192, 0.7)',
                'rgba(255, 206, 86, 0.7)',
                'rgba(255, 99, 132, 0.7)'
              ],
              borderColor: [
                'rgba(75, 192, 192, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(255, 99, 132, 1)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const value = context.raw;
                    const percent = Math.round(value/total*100);
                    return `${context.label}: ${value.toLocaleString()}đ (${percent}%)`;
                  }
                }
              }
            },
            cutout: '70%'
          }
        });
      }
    });
    </script>
</body>
</html>