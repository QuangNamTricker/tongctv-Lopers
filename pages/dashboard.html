<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hệ Thống Quản Lý Lương Đa Nhánh</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    .dashboard-page {
      padding: 20px;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .header-title h2 {
      font-size: 1.8rem;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 5px;
    }
    
    .header-title h2 i {
      color: #4361ee;
    }
    
    .header-title p {
      color: #7f8c8d;
      font-size: 0.9rem;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .date-range-picker {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 15px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .date-range-picker:hover {
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .date-range-picker i {
      font-size: 0.9rem;
      color: #7f8c8d;
    }
    
    .btn {
      padding: 8px 15px;
      border-radius: 8px;
      border: none;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }
    
    .btn i {
      font-size: 0.9em;
    }
    
    .refresh-btn {
      background-color: #f8f9fa;
      color: #2c3e50;
      border: 1px solid #ddd;
    }
    
    .refresh-btn:hover {
      background-color: #e9ecef;
    }
    
    .refresh-btn.rotating i {
      animation: rotate 1s linear;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .stat-card {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      z-index: 1;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .stat-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      margin-bottom: 15px;
      color: white;
    }
    
    .stat-card.primary .stat-icon { background-color: #4361ee; }
    .stat-card.success .stat-icon { background-color: #2ecc71; }
    .stat-card.warning .stat-icon { background-color: #f39c12; }
    .stat-card.danger .stat-icon { background-color: #e74c3c; }
    
    .stat-info h3 {
      font-size: 1.8rem;
      margin-bottom: 5px;
      color: #2c3e50;
    }
    
    .stat-info p {
      color: #7f8c8d;
      font-size: 0.9rem;
    }
    
    .stat-trend {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      padding: 3px 8px;
      border-radius: 10px;
    }
    
    .stat-trend i {
      font-size: 0.7rem;
      margin-right: 3px;
    }
    
    .stat-trend.up {
      background-color: rgba(46, 204, 113, 0.1);
      color: #2ecc71;
    }
    
    .stat-trend.down {
      background-color: rgba(231, 76, 60, 0.1);
      color: #e74c3c;
    }
    
    .stat-wave {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 100px;
      height: 100px;
      background-size: 50px 50px;
      opacity: 0.1;
      z-index: -1;
    }
    
    .stat-card.primary .stat-wave { background-image: radial-gradient(circle, #4361ee 20%, transparent 20%); }
    .stat-card.success .stat-wave { background-image: radial-gradient(circle, #2ecc71 20%, transparent 20%); }
    .stat-card.warning .stat-wave { background-image: radial-gradient(circle, #f39c12 20%, transparent 20%); }
    .stat-card.danger .stat-wave { background-image: radial-gradient(circle, #e74c3c 20%, transparent 20%); }
    
    .dashboard-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 1200px) {
      .dashboard-row {
        grid-template-columns: 1fr;
      }
    }
    
    .card {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .card:hover {
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .card-header {
      padding: 20px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-header h3 {
      font-size: 1.2rem;
      color: #2c3e50;
    }
    
    .card-body {
      padding: 20px;
    }
    
    .main-chart-card {
      grid-column: 1;
    }
    
    .pie-chart-card {
      position: relative;
    }
    
    .chart-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .chart-period-select {
      padding: 5px 10px;
      border-radius: 5px;
      border: 1px solid #ddd;
      font-size: 0.9rem;
      cursor: pointer;
    }
    
    .chart-period-select:focus {
      outline: none;
      border-color: #4361ee;
    }
    
    .btn-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: #f8f9fa;
      color: #7f8c8d;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-icon:hover {
      background-color: #e9ecef;
      color: #4361ee;
    }
    
    .chart-legend {
      position: absolute;
      bottom: 20px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }
    
    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    
    .legend-color.meiu {
      background-color: #4361ee;
    }
    
    .legend-color.s02 {
      background-color: #4cc9f0;
    }
    
    .legend-value {
      font-weight: 500;
      color: #2c3e50;
    }
    
    .top-members-card .card-header {
      padding-bottom: 15px;
    }
    
    .view-all {
      color: #4361ee;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .view-all:hover {
      text-decoration: underline;
    }
    
    .view-all i {
      font-size: 0.7rem;
    }
    
    .top-members-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .top-member-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    .top-member-item:hover {
      background-color: #f8f9fa;
    }
    
    .member-rank {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #f1f2f6;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #7f8c8d;
      flex-shrink: 0;
    }
    
    .top-member-item:nth-child(1) .member-rank {
      background-color: #ffd700;
      color: white;
    }
    
    .top-member-item:nth-child(2) .member-rank {
      background-color: #c0c0c0;
      color: white;
    }
    
    .top-member-item:nth-child(3) .member-rank {
      background-color: #cd7f32;
      color: white;
    }
    
    .member-info {
      flex: 1;
    }
    
    .member-name {
      font-weight: 500;
      color: #2c3e50;
      margin-bottom: 3px;
    }
    
    .member-team {
      font-size: 0.8rem;
      padding: 2px 8px;
      border-radius: 10px;
      display: inline-block;
    }
    
    .member-team.meiu {
      background-color: rgba(67, 97, 238, 0.1);
      color: #4361ee;
    }
    
    .member-team.s02 {
      background-color: rgba(76, 201, 240, 0.1);
      color: #4cc9f0;
    }
    
    .member-stats {
      text-align: right;
      margin-right: 15px;
    }
    
    .stat-amount {
      font-weight: 500;
      color: #2c3e50;
      margin-bottom: 3px;
    }
    
    .stat-tasks {
      font-size: 0.8rem;
      color: #7f8c8d;
    }
    
    .member-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #4361ee;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
    }
    
    .activities-card .card-body {
      padding-top: 10px;
    }
    
    .activity-timeline {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .activity-item {
      display: flex;
      gap: 15px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    
    .activity-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }
    
    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      color: white;
      flex-shrink: 0;
    }
    
    .activity-icon.payment {
      background-color: #2ecc71;
    }
    
    .activity-icon.add {
      background-color: #3498db;
    }
    
    .activity-icon.update {
      background-color: #f39c12;
    }
    
    .activity-icon.task {
      background-color: #9b59b6;
    }
    
    .activity-content h5 {
      font-size: 1rem;
      color: #2c3e50;
      margin-bottom: 5px;
    }
    
    .activity-content p {
      font-size: 0.9rem;
      color: #7f8c8d;
      margin-bottom: 10px;
    }
    
    .activity-meta {
      display: flex;
      gap: 15px;
      font-size: 0.8rem;
      color: #7f8c8d;
    }
    
    .activity-meta span {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    /* Chart canvas sizing */
    #salaryChart, #teamDistributionChart {
      width: 100% !important;
      height: 300px !important;
    }
    
    @media (max-width: 768px) {
      .page-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .header-actions {
        width: 100%;
        justify-content: space-between;
      }
      
      .stats-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    @media (max-width: 576px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .header-actions {
        flex-direction: column;
        gap: 10px;
      }
      
      .date-range-picker {
        width: 100%;
        justify-content: space-between;
      }
    }
    </style>
</head>
<body>

    <div class="dashboard-page">
        <div class="page-header">
          <div class="header-title">
            <h2><i class="fas fa-tachometer-alt"></i> Dashboard Tổng Quan</h2>
            <p>Tổng hợp thông tin hoạt động của hệ thống</p>
          </div>
          <div class="header-actions">
            <div class="date-range-picker">
              <i class="fas fa-calendar-alt"></i>
              <span id="currentDateRange">01/06/2025 - 30/06/2025</span>
              <i class="fas fa-chevron-down"></i>
            </div>
            <button class="btn refresh-btn" id="refreshDashboard">
              <i class="fas fa-sync-alt"></i> Làm mới
            </button>
          </div>
        </div>
      
        <div class="stats-grid">
          <!-- Stat Card 1 -->
          <div class="stat-card primary">
            <div class="stat-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-info">
              <h3 id="totalMembers">0</h3>
              <p>Tổng thành viên</p>
            </div>
            <div class="stat-trend up">
              <i class="fas fa-arrow-up"></i> 12%
            </div>
            <div class="stat-wave"></div>
          </div>
          
          <!-- Stat Card 2 -->
          <div class="stat-card success">
            <div class="stat-icon">
              <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="stat-info">
              <h3 id="totalSalary">0đ</h3>
              <p>Tổng lương tháng</p>
            </div>
            <div class="stat-trend up">
              <i class="fas fa-arrow-up"></i> 8%
            </div>
            <div class="stat-wave"></div>
          </div>
          
          <!-- Stat Card 3 -->
          <div class="stat-card warning">
            <div class="stat-icon">
              <i class="fas fa-tasks"></i>
            </div>
            <div class="stat-info">
              <h3 id="totalTasks">0</h3>
              <p>Tổng công việc</p>
            </div>
            <div class="stat-trend down">
              <i class="fas fa-arrow-down"></i> 5%
            </div>
            <div class="stat-wave"></div>
          </div>
          
          <!-- Stat Card 4 -->
          <div class="stat-card danger">
            <div class="stat-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stat-info">
              <h3 id="pendingPayments">0</h3>
              <p>Chờ thanh toán</p>
            </div>
            <div class="stat-trend up">
              <i class="fas fa-arrow-up"></i> 3%
            </div>
            <div class="stat-wave"></div>
          </div>
        </div>
      
        <div class="dashboard-row">
          <!-- Main Chart -->
          <div class="card main-chart-card">
            <div class="card-header">
              <h3>Biểu đồ lương theo ngày</h3>
              <div class="chart-actions">
                <select class="chart-period-select">
                  <option value="7">7 ngày</option>
                  <option value="14">14 ngày</option>
                  <option value="30" selected>30 ngày</option>
                </select>
                <button class="btn btn-icon">
                  <i class="fas fa-download"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <canvas id="salaryChart"></canvas>
            </div>
          </div>
          
          <!-- Pie Chart -->
          <div class="card pie-chart-card">
            <div class="card-header">
              <h3>Phân bổ lương theo nhóm</h3>
            </div>
            <div class="card-body">
              <canvas id="teamDistributionChart"></canvas>
              <div class="chart-legend">
                <div class="legend-item">
                  <span class="legend-color meiu"></span>
                  <span>MEIU</span>
                  <span class="legend-value" id="meiuPercent">0%</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color s02"></span>
                  <span>S02-LOPERS</span>
                  <span class="legend-value" id="s02Percent">0%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      
        <div class="dashboard-row">
          <!-- Top Members -->
          <div class="card top-members-card">
            <div class="card-header">
              <h3>Top thành viên tháng</h3>
              <a href="../pages/salary.html" class="view-all">Xem tất cả <i class="fas fa-chevron-right"></i></a>
            </div>
            <div class="card-body">
              <div class="top-members-list" id="topMembersList">
                <!-- Data will be loaded here -->
              </div>
            </div>
          </div>
          
          <!-- Recent Activities -->
          <div class="card activities-card">
            <div class="card-header">
              <h3>Hoạt động gần đây</h3>
            </div>
            <div class="card-body">
              <div class="activity-timeline" id="activityTimeline">
                <!-- Data will be loaded here -->
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Load data based on selected branch
        const selectedBranch = localStorage.getItem('selectedBranch') || 'meiu';
        const meiuDataFile = '../data/meiu.json';
        const s02DataFile = '../data/s02-lopers.json';
        
        // Fetch data from both branches
        Promise.all([
          fetch(meiuDataFile).then(res => res.json()),
          fetch(s02DataFile).then(res => res.json())
        ])
        .then(([meiuData, s02Data]) => {
          // Process and combine data
          const combinedData = combineData(meiuData, s02Data);
          updateDashboard(combinedData);
          initCharts(combinedData);
        })
        .catch(error => {
          console.error('Error loading data:', error);
        });
      
        // Combine data from both branches
        function combineData(meiuData, s02Data) {
          // This is a simplified example - in a real app you would need to properly combine the data
          return {
            meiu: meiuData,
            s02: s02Data,
            lastUpdated: new Date().toISOString()
          };
        }
      
        // Update dashboard stats
        function updateDashboard(data) {
          // Calculate totals
          let totalMembers = 0;
          let totalSalary = 0;
          let totalTasks = 0;
          let pendingPayments = 0;
          
          // Process MEIU data
          Object.values(data.meiu).forEach(dayData => {
            dayData.forEach(member => {
              totalMembers++;
              const amount = member.quantity * member.unitPrice;
              totalSalary += amount;
              totalTasks += member.quantity;
              if (member.status !== "Đã thanh toán") pendingPayments += amount;
            });
          });
          
          // Process S02 data
          Object.values(data.s02).forEach(dayData => {
            dayData.forEach(member => {
              totalMembers++;
              const amount = member.quantity * member.unitPrice;
              totalSalary += amount;
              totalTasks += member.quantity;
              if (member.status !== "Đã thanh toán") pendingPayments += amount;
            });
          });
          
          // Animate numbers
          animateValue(document.getElementById('totalMembers'), 0, totalMembers, 1000);
          animateValue(document.getElementById('totalSalary'), 0, totalSalary, 1000, true);
          animateValue(document.getElementById('totalTasks'), 0, totalTasks, 1000);
          animateValue(document.getElementById('pendingPayments'), 0, pendingPayments, 1000, true);
          
          // Update top members
          updateTopMembers(data);
          updateRecentActivities(data);
        }
      
        // Animate number values
        function animateValue(element, start, end, duration, isCurrency = false) {
          const startTime = performance.now();
          const suffix = isCurrency ? 'đ' : '';
          
          function updateValue(time) {
            const elapsed = time - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const value = Math.floor(start + progress * (end - start));
            element.textContent = value.toLocaleString() + suffix;
            
            if (progress < 1) {
              requestAnimationFrame(updateValue);
            }
          }
          
          requestAnimationFrame(updateValue);
        }
      
        // Update top members list
        function updateTopMembers(data) {
          // In a real app, you would calculate top members from the data
          const topMembers = [
            { name: "Nguyễn Văn A", team: "MEIU", amount: 12500000, tasks: 42 },
            { name: "Trần Thị B", team: "S02-LOPERS", amount: 11800000, tasks: 39 },
            { name: "Lê Văn C", team: "MEIU", amount: 11200000, tasks: 37 },
            { name: "Phạm Thị D", team: "S02-LOPERS", amount: 10500000, tasks: 35 },
            { name: "Hoàng Văn E", team: "MEIU", amount: 9800000, tasks: 32 }
          ];
          
          const topMembersList = document.getElementById('topMembersList');
          topMembersList.innerHTML = '';
          
          topMembers.forEach((member, index) => {
            const memberEl = document.createElement('div');
            memberEl.className = 'top-member-item';
            memberEl.innerHTML = `
              <div class="member-rank">${index + 1}</div>
              <div class="member-info">
                <div class="member-name">${member.name}</div>
                <div class="member-team ${member.team === 'MEIU' ? 'meiu' : 's02'}">${member.team}</div>
              </div>
              <div class="member-stats">
                <div class="stat-amount">${member.amount.toLocaleString()}đ</div>
                <div class="stat-tasks">${member.tasks} tasks</div>
              </div>
              <div class="member-avatar">
                ${member.name.split(' ').map(n => n[0]).join('')}
              </div>
            `;
            topMembersList.appendChild(memberEl);
          });
        }
      
        // Update recent activities
        function updateRecentActivities(data) {
          // In a real app, you would get activities from the data
          const activities = [
            {
              type: "payment",
              title: "Thanh toán lương tháng 6",
              description: "Đã thanh toán cho 45 thành viên",
              date: "30/06/2025",
              user: "Hệ thống"
            },
            {
              type: "add",
              title: "Thêm thành viên mới",
              description: "Đã thêm Nguyễn Văn F vào nhóm MEIU",
              date: "28/06/2025",
              user: "Quản trị viên"
            },
            {
              type: "update",
              title: "Cập nhật thông tin",
              description: "Đã cập nhật đơn giá cho nhóm S02-LOPERS",
              date: "25/06/2025",
              user: "Quản trị viên"
            },
            {
              type: "task",
              title: "Hoàn thành đợt công việc",
              description: "Đã hoàn thành 125 tasks trong ngày",
              date: "24/06/2025",
              user: "Hệ thống"
            }
          ];
          
          const activityTimeline = document.getElementById('activityTimeline');
          activityTimeline.innerHTML = '';
          
          activities.forEach(activity => {
            const activityEl = document.createElement('div');
            activityEl.className = 'activity-item';
            activityEl.innerHTML = `
              <div class="activity-icon ${activity.type}">
                <i class="fas fa-${
                  activity.type === 'payment' ? 'money-bill-wave' : 
                  activity.type === 'add' ? 'user-plus' : 
                  activity.type === 'update' ? 'edit' : 'tasks'
                }"></i>
              </div>
              <div class="activity-content">
                <h5>${activity.title}</h5>
                <p>${activity.description}</p>
                <div class="activity-meta">
                  <span><i class="fas fa-calendar-alt"></i> ${activity.date}</span>
                  <span><i class="fas fa-user"></i> ${activity.user}</span>
                </div>
              </div>
            `;
            activityTimeline.appendChild(activityEl);
          });
        }
      
        // Initialize charts
        function initCharts(data) {
          // Salary by day chart (for the last 30 days)
          const days = Array.from({ length: 30 }, (_, i) => {
            const date = new Date();
            date.setDate(date.getDate() - (29 - i));
            return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
          });
          
          const meiuDailyData = days.map(day => {
            const dayData = data.meiu[day] || [];
            return dayData.reduce((sum, member) => sum + (member.quantity * member.unitPrice), 0);
          });
          
          const s02DailyData = days.map(day => {
            const dayData = data.s02[day] || [];
            return dayData.reduce((sum, member) => sum + (member.quantity * member.unitPrice), 0);
          });
          
          const ctx1 = document.getElementById('salaryChart').getContext('2d');
          new Chart(ctx1, {
            type: 'line',
            data: {
              labels: days,
              datasets: [
                {
                  label: 'MEIU',
                  data: meiuDailyData,
                  borderColor: '#4361ee',
                  backgroundColor: 'rgba(67, 97, 238, 0.1)',
                  borderWidth: 2,
                  tension: 0.4,
                  fill: true
                },
                {
                  label: 'S02-LOPERS',
                  data: s02DailyData,
                  borderColor: '#4cc9f0',
                  backgroundColor: 'rgba(76, 201, 240, 0.1)',
                  borderWidth: 2,
                  tension: 0.4,
                  fill: true
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: 'top',
                },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      return `${context.dataset.label}: ${context.raw.toLocaleString()}đ`;
                    }
                  }
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function(value) {
                      return value.toLocaleString() + 'đ';
                    }
                  }
                }
              }
            }
          });
          
          // Team distribution pie chart
          const meiuTotal = Object.values(data.meiu).flat().reduce((sum, member) => 
            sum + (member.quantity * member.unitPrice), 0);
          const s02Total = Object.values(data.s02).flat().reduce((sum, member) => 
            sum + (member.quantity * member.unitPrice), 0);
          const total = meiuTotal + s02Total;
          
          document.getElementById('meiuPercent').textContent = Math.round(meiuTotal/total*100) + '%';
          document.getElementById('s02Percent').textContent = Math.round(s02Total/total*100) + '%';
          
          const ctx2 = document.getElementById('teamDistributionChart').getContext('2d');
          new Chart(ctx2, {
            type: 'doughnut',
            data: {
              labels: ['MEIU', 'S02-LOPERS'],
              datasets: [{
                data: [meiuTotal, s02Total],
                backgroundColor: [
                  'rgba(67, 97, 238, 0.7)',
                  'rgba(76, 201, 240, 0.7)'
                ],
                borderColor: [
                  'rgba(67, 97, 238, 1)',
                  'rgba(76, 201, 240, 1)'
                ],
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  display: false
                },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      const value = context.raw;
                      const percent = Math.round(value/total*100);
                      return `${context.label}: ${value.toLocaleString()}đ (${percent}%)`;
                    }
                  }
                }
              },
              cutout: '70%'
            }
          });
        }
      
        // Refresh button
        document.getElementById('refreshDashboard').addEventListener('click', function() {
          this.classList.add('rotating');
          setTimeout(() => {
            this.classList.remove('rotating');
          }, 1000);
          // In a real app, you would reload the data here
          console.log('Refreshing dashboard...');
        });
      
        // Set current date range
        const currentDate = new Date();
        const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
        const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
        
        document.getElementById('currentDateRange').textContent = 
          `${formatDate(firstDay)} - ${formatDate(lastDay)}`;
        
        function formatDate(date) {
          const day = date.getDate().toString().padStart(2, '0');
          const month = (date.getMonth() + 1).toString().padStart(2, '0');
          const year = date.getFullYear();
          return `${day}/${month}/${year}`;
        }
      });
      </script>
      

    
</body>
</html>