<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hệ Thống Quản Lý Lương Đa Nhánh</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    .salary-page {
      padding: 20px;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .header-title h2 {
      font-size: 1.8rem;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 5px;
    }
    
    .header-title h2 i {
      color: #4bc0c0;
    }
    
    .header-title p {
      color: #7f8c8d;
      font-size: 0.9rem;
    }
    
    .header-actions {
      display: flex;
      gap: 10px;
    }
    
    .btn {
      padding: 10px 15px;
      border-radius: 8px;
      border: none;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }
    
    .btn i {
      font-size: 0.9em;
    }
    
    .export-btn {
      background-color: #2ecc71;
      color: white;
    }
    
    .export-btn:hover {
      background-color: #27ae60;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
    }
    
    .print-btn {
      background-color: #3498db;
      color: white;
    }
    
    .print-btn:hover {
      background-color: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }
    
    .salary-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 25px;
      padding: 20px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .control-group label {
      font-size: 0.9rem;
      color: #7f8c8d;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .nice-select {
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-family: 'Poppins', sans-serif;
      min-width: 180px;
      cursor: pointer;
      transition: all 0.3s ease;
      background-color: white;
    }
    
    .nice-select:focus {
      outline: none;
      border-color: #4bc0c0;
      box-shadow: 0 0 0 2px rgba(75, 192, 192, 0.2);
    }
    
    .search-group {
      flex: 1;
      min-width: 250px;
    }
    
    .search-input {
      position: relative;
      flex: 1;
    }
    
    .search-input i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #7f8c8d;
    }
    
    .search-input input {
      width: 100%;
      padding: 10px 15px 10px 40px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease;
    }
    
    .search-input input:focus {
      outline: none;
      border-color: #4bc0c0;
      box-shadow: 0 0 0 2px rgba(75, 192, 192, 0.2);
    }
    
    .salary-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .summary-card {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      z-index: 1;
      animation: cardEntrance 0.6s ease-out;
      animation-fill-mode: backwards;
    }
    
    .summary-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .summary-card:nth-child(1) { animation-delay: 0.1s; }
    .summary-card:nth-child(2) { animation-delay: 0.2s; }
    .summary-card:nth-child(3) { animation-delay: 0.3s; }
    .summary-card:nth-child(4) { animation-delay: 0.4s; }
    
    @keyframes cardEntrance {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .card-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 15px;
      color: white;
    }
    
    .total-salary .card-icon { background-color: #4361ee; }
    .paid-salary .card-icon { background-color: #2ecc71; }
    .pending-salary .card-icon { background-color: #f39c12; }
    .avg-salary .card-icon { background-color: #9b59b6; }
    
    .card-content h3 {
      font-size: 1.8rem;
      margin-bottom: 5px;
      color: #2c3e50;
    }
    
    .card-content p {
      color: #7f8c8d;
      font-size: 0.9rem;
    }
    
    .card-wave {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 100px;
      height: 100px;
      background-size: 50px 50px;
      opacity: 0.1;
      z-index: -1;
    }
    
    .total-salary .card-wave { background-image: radial-gradient(circle, #4361ee 20%, transparent 20%); }
    .paid-salary .card-wave { background-image: radial-gradient(circle, #2ecc71 20%, transparent 20%); }
    .pending-salary .card-wave { background-image: radial-gradient(circle, #f39c12 20%, transparent 20%); }
    .avg-salary .card-wave { background-image: radial-gradient(circle, #9b59b6 20%, transparent 20%); }
    
    .salary-table-container {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      margin-bottom: 20px;
    }
    
    .animated-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .animated-table th {
      background-color: #f8f9fa;
      padding: 15px;
      text-align: left;
      font-weight: 500;
      color: #2c3e50;
      position: sticky;
      top: 0;
      z-index: 10;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .animated-table th:hover {
      background-color: #e9ecef;
    }
    
    .animated-table th i {
      margin-left: 5px;
      font-size: 0.8em;
      color: #7f8c8d;
    }
    
    .animated-table td {
      padding: 15px;
      border-bottom: 1px solid #eee;
      color: #2c3e50;
    }
    
    .animated-table tr:last-child td {
      border-bottom: none;
    }
    
    .salary-row {
      transition: all 0.3s ease;
    }
    
    .salary-row:hover {
      background-color: #f8f9fa !important;
      transform: scale(1.005);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }
    
    .salary-row.even {
      background-color: #fdfdfd;
    }
    
    .salary-row.odd {
      background-color: white;
    }
    
    .member-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .member-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #4361ee;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
    }
    
    .member-name {
      font-weight: 500;
    }
    
    .amount-cell {
      font-weight: 500;
      color: #2c3e50;
    }
    
    .status-badge {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      display: inline-block;
    }
    
    .status-badge.paid {
      background-color: rgba(46, 204, 113, 0.1);
      color: #2ecc71;
    }
    
    .status-badge.pending {
      background-color: rgba(243, 156, 18, 0.1);
      color: #f39c12;
    }
    
    .status-badge.cancelled {
      background-color: rgba(231, 76, 60, 0.1);
      color: #e74c3c;
    }
    
    .action-btn {
      padding: 6px 12px;
      border-radius: 20px;
      border: none;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .pay-btn {
      background-color: rgba(46, 204, 113, 0.1);
      color: #2ecc71;
    }
    
    .pay-btn:hover {
      background-color: #2ecc71;
      color: white;
      transform: translateY(-2px);
    }
    
    .view-btn {
      background-color: rgba(52, 152, 219, 0.1);
      color: #3498db;
    }
    
    .view-btn:hover {
      background-color: #3498db;
      color: white;
      transform: translateY(-2px);
    }
    
    .table-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      border-top: 1px solid #eee;
    }
    
    .pagination-info {
      font-size: 0.9rem;
      color: #7f8c8d;
    }
    
    .pagination-controls {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .pagination-btn {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      border: 1px solid #ddd;
      background-color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .pagination-btn:hover:not(:disabled) {
      background-color: #f8f9fa;
      border-color: #7f8c8d;
    }
    
    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .page-numbers {
      display: flex;
      gap: 5px;
    }
    
    .page-number {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      border: none;
      background-color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .page-number:hover {
      background-color: #f8f9fa;
    }
    
    .page-number.active {
      background-color: #4361ee;
      color: white;
    }
    
    .page-ellipsis {
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #7f8c8d;
    }
    
    .payment-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .modal-content {
      background-color: white;
      border-radius: 10px;
      width: 100%;
      max-width: 450px;
      overflow: hidden;
      transform: translateY(-20px);
      opacity: 0;
      transition: all 0.3s ease;
    }
    
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-header h3 {
      font-size: 1.3rem;
      color: #2c3e50;
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #7f8c8d;
      transition: all 0.3s ease;
    }
    
    .close-modal:hover {
      color: #e74c3c;
      transform: rotate(90deg);
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .modal-body p {
      margin-bottom: 15px;
      color: #2c3e50;
    }
    
    .payment-details {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
    }
    
    .payment-details p {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .payment-details p:last-child {
      margin-bottom: 0;
    }
    
    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    .cancel-btn {
      background-color: #f8f9fa;
      color: #7f8c8d;
    }
    
    .cancel-btn:hover {
      background-color: #e9ecef;
    }
    
    .confirm-btn {
      background-color: #2ecc71;
      color: white;
    }
    
    .confirm-btn:hover {
      background-color: #27ae60;
    }
    
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: white;
      border-radius: 8px;
      padding: 15px 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 10px;
      transform: translateX(100%);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    .notification.show {
      transform: translateX(0);
      opacity: 1;
    }
    
    .notification i {
      font-size: 1.2rem;
    }
    
    .notification.success {
      border-left: 4px solid #2ecc71;
    }
    
    .notification.success i {
      color: #2ecc71;
    }
    
    .notification.info {
      border-left: 4px solid #3498db;
    }
    
    .notification.info i {
      color: #3498db;
    }
    
    .error-message {
      color: #e74c3c;
      text-align: center;
      padding: 20px;
    }
    
    .no-data {
      color: #7f8c8d;
      text-align: center;
      padding: 20px;
    }
    
    @media (max-width: 768px) {
      .page-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .header-actions {
        width: 100%;
        justify-content: flex-end;
      }
      
      .salary-summary {
        grid-template-columns: 1fr 1fr;
      }
      
      .table-footer {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }
      
      .pagination-controls {
        width: 100%;
        justify-content: center;
      }
    }
    
    @media (max-width: 480px) {
      .salary-summary {
        grid-template-columns: 1fr;
      }
      
      .salary-controls {
        flex-direction: column;
      }
      
      .control-group {
        width: 100%;
      }
      
      .nice-select {
        width: 100%;
      }
    }
    </style>
</head>
<body>
    <div class="salary-page">
        <div class="page-header">
          <div class="header-title">
            <h2><i class="fas fa-money-bill-wave"></i> Bảng Lương Thành Viên</h2>
            <p>Quản lý và theo dõi chi tiết lương của từng thành viên</p>
          </div>
          <div class="header-actions">
            <button class="btn export-btn" id="exportExcel">
              <i class="fas fa-file-excel"></i> Xuất Excel
            </button>
            <button class="btn print-btn" id="printReport">
              <i class="fas fa-print"></i> In Báo Cáo
            </button>
          </div>
        </div>
      
        <div class="salary-controls">
          <div class="control-group">
            <label for="dateFilter"><i class="fas fa-calendar-alt"></i> Lọc theo ngày:</label>
            <select id="dateFilter" class="nice-select">
              <option value="all">Tất cả ngày</option>
              <!-- Options will be populated by JavaScript -->
            </select>
          </div>
          
          <div class="control-group">
            <label for="statusFilter"><i class="fas fa-filter"></i> Trạng thái:</label>
            <select id="statusFilter" class="nice-select">
              <option value="all">Tất cả</option>
              <option value="Đã thanh toán">Đã thanh toán</option>
              <option value="Chờ xử lý">Chờ xử lý</option>
              <option value="Đã hủy">Đã hủy</option>
            </select>
          </div>
          
          <div class="control-group search-group">
            <label for="memberSearch"><i class="fas fa-search"></i> Tìm kiếm:</label>
            <div class="search-input">
              <input type="text" id="memberSearch" placeholder="Nhập tên thành viên...">
              <i class="fas fa-search"></i>
            </div>
          </div>
        </div>
      
        <div class="salary-summary animated-cards">
          <div class="summary-card total-salary">
            <div class="card-icon">
              <i class="fas fa-coins"></i>
            </div>
            <div class="card-content">
              <h3 id="totalSalaryAmount">0đ</h3>
              <p>Tổng lương</p>
            </div>
            <div class="card-wave"></div>
          </div>
          
          <div class="summary-card paid-salary">
            <div class="card-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="card-content">
              <h3 id="paidSalaryAmount">0đ</h3>
              <p>Đã thanh toán</p>
            </div>
            <div class="card-wave"></div>
          </div>
          
          <div class="summary-card pending-salary">
            <div class="card-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="card-content">
              <h3 id="pendingSalaryAmount">0đ</h3>
              <p>Chờ xử lý</p>
            </div>
            <div class="card-wave"></div>
          </div>
          
          <div class="summary-card avg-salary">
            <div class="card-icon">
              <i class="fas fa-calculator"></i>
            </div>
            <div class="card-content">
              <h3 id="avgSalaryAmount">0đ</h3>
              <p>Trung bình/người</p>
            </div>
            <div class="card-wave"></div>
          </div>
        </div>
      
        <div class="salary-table-container">
          <table class="animated-table" id="salaryTable">
            <thead>
              <tr>
                <th data-sort="name">Thành viên <i class="fas fa-sort"></i></th>
                <th data-sort="date">Ngày <i class="fas fa-sort"></i></th>
                <th data-sort="quantity">Số lượng <i class="fas fa-sort"></i></th>
                <th data-sort="unitPrice">Đơn giá <i class="fas fa-sort"></i></th>
                <th data-sort="amount">Thành tiền <i class="fas fa-sort"></i></th>
                <th data-sort="status">Trạng thái <i class="fas fa-sort"></i></th>
                <th>Hành động</th>
              </tr>
            </thead>
            <tbody id="salaryTableBody">
              <!-- Data will be loaded here -->
            </tbody>
          </table>
          
          <div class="table-footer">
            <div class="pagination-info" id="paginationInfo">
              Hiển thị 0-0 của 0 bản ghi
            </div>
            <div class="pagination-controls">
              <button class="pagination-btn" id="prevPage" disabled>
                <i class="fas fa-chevron-left"></i>
              </button>
              <div class="page-numbers" id="pageNumbers">
                <!-- Page numbers will be added here -->
              </div>
              <button class="pagination-btn" id="nextPage" disabled>
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
        
        <div class="payment-modal" id="paymentModal">
          <div class="modal-content">
            <div class="modal-header">
              <h3>Xác nhận thanh toán</h3>
              <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
              <p>Bạn có chắc chắn muốn đánh dấu đã thanh toán cho <span id="modalMemberName"></span>?</p>
              <div class="payment-details">
                <p><strong>Số lượng:</strong> <span id="modalQuantity"></span></p>
                <p><strong>Thành tiền:</strong> <span id="modalAmount"></span></p>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn cancel-btn">Hủy bỏ</button>
              <button class="btn confirm-btn">Xác nhận</button>
            </div>
          </div>
        </div>
      </div>
      
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Load data based on selected branch
      const selectedBranch = localStorage.getItem('selectedBranch') || 'meiu';
      const dataFile = selectedBranch === 'meiu' ? '../data/meiu.json' : '../data/s02-lopers.json';
      
      let allSalaryData = [];
      let filteredData = [];
      let currentPage = 1;
      const rowsPerPage = 10;
      let currentSort = { column: 'date', direction: 'desc' };
    
      // DOM Elements
      const tableBody = document.getElementById('salaryTableBody');
      const dateFilter = document.getElementById('dateFilter');
      const statusFilter = document.getElementById('statusFilter');
      const memberSearch = document.getElementById('memberSearch');
      const prevPageBtn = document.getElementById('prevPage');
      const nextPageBtn = document.getElementById('nextPage');
      const pageNumbers = document.getElementById('pageNumbers');
      const paginationInfo = document.getElementById('paginationInfo');
      const paymentModal = document.getElementById('paymentModal');
      
      // Summary elements
      const totalSalaryEl = document.getElementById('totalSalaryAmount');
      const paidSalaryEl = document.getElementById('paidSalaryAmount');
      const pendingSalaryEl = document.getElementById('pendingSalaryAmount');
      const avgSalaryEl = document.getElementById('avgSalaryAmount');
    
      // Fetch data
      fetch(dataFile)
        .then(response => response.json())
        .then(data => {
          // Transform data to flat array
          allSalaryData = Object.entries(data).flatMap(([date, items]) => 
            items.map(item => ({
              ...item,
              date,
              amount: item.quantity * item.unitPrice
            }))
          );
          
          // Populate date filter
          const uniqueDates = [...new Set(allSalaryData.map(item => item.date))].sort();
          uniqueDates.forEach(date => {
            const option = document.createElement('option');
            option.value = date;
            option.textContent = date;
            dateFilter.appendChild(option);
          });
          
          // Initial render
          filterData();
          renderTable();
          updateSummary();
          
          // Add sort handlers
          document.querySelectorAll('th[data-sort]').forEach(header => {
            header.addEventListener('click', () => {
              const column = header.getAttribute('data-sort');
              const direction = currentSort.column === column && currentSort.direction === 'asc' ? 'desc' : 'asc';
              currentSort = { column, direction };
              sortData();
              renderTable();
              updateSortIcons();
            });
          });
        })
        .catch(error => {
          console.error('Error loading data:', error);
          tableBody.innerHTML = '<tr><td colspan="7" class="error-message">Không thể tải dữ liệu</td></tr>';
        });
    
      // Filter data based on filters and search
      function filterData() {
        const dateValue = dateFilter.value;
        const statusValue = statusFilter.value;
        const searchValue = memberSearch.value.toLowerCase();
        
        filteredData = allSalaryData.filter(item => {
          return (dateValue === 'all' || item.date === dateValue) &&
                 (statusValue === 'all' || item.status === statusValue) &&
                 (searchValue === '' || item.name.toLowerCase().includes(searchValue));
        });
        
        sortData();
        currentPage = 1;
        updatePagination();
      }
    
      // Sort data
      function sortData() {
        filteredData.sort((a, b) => {
          let comparison = 0;
          
          if (currentSort.column === 'name') {
            comparison = a.name.localeCompare(b.name);
          } else if (currentSort.column === 'date') {
            comparison = new Date(a.date.split('/').reverse().join('-')) - 
                        new Date(b.date.split('/').reverse().join('-'));
          } else {
            comparison = a[currentSort.column] - b[currentSort.column];
          }
          
          return currentSort.direction === 'asc' ? comparison : -comparison;
        });
      }
    
      // Update sort icons
      function updateSortIcons() {
        document.querySelectorAll('th i.fa-sort').forEach(icon => {
          icon.className = 'fas fa-sort';
        });
        
        const header = document.querySelector(`th[data-sort="${currentSort.column}"]`);
        if (header) {
          const icon = header.querySelector('i');
          icon.className = currentSort.direction === 'asc' ? 
            'fas fa-sort-up' : 'fas fa-sort-down';
        }
      }
    
      // Render table with pagination
      function renderTable() {
        const start = (currentPage - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const pageData = filteredData.slice(start, end);
        
        tableBody.innerHTML = '';
        
        if (pageData.length === 0) {
          tableBody.innerHTML = '<tr><td colspan="7" class="no-data">Không có dữ liệu</td></tr>';
          return;
        }
        
        pageData.forEach((item, index) => {
          const row = document.createElement('tr');
          row.className = `salary-row ${index % 2 === 0 ? 'even' : 'odd'}`;
          row.innerHTML = `
            <td>
              <div class="member-info">
                <div class="member-avatar">${item.name.charAt(0)}</div>
                <div class="member-name">${item.name}</div>
              </div>
            </td>
            <td>${item.date}</td>
            <td>${item.quantity}</td>
            <td>${item.unitPrice.toLocaleString()}đ</td>
            <td class="amount-cell">${item.amount.toLocaleString()}đ</td>
            <td>
              <span class="status-badge ${getStatusClass(item.status)}">
                ${item.status}
              </span>
            </td>
            <td>
              ${item.status === 'Chờ xử lý' ? 
                `<button class="action-btn pay-btn" data-id="${start + index}">
                  <i class="fas fa-check"></i> Thanh toán
                </button>` : 
                `<button class="action-btn view-btn" data-id="${start + index}">
                  <i class="fas fa-eye"></i> Xem
                </button>`
              }
            </td>
          `;
          tableBody.appendChild(row);
        });
        
        // Add event listeners to action buttons
        document.querySelectorAll('.pay-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const index = parseInt(btn.getAttribute('data-id'));
            const item = filteredData[index];
            showPaymentModal(item, index);
          });
        });
      }
    
      // Update summary cards
      function updateSummary() {
        const total = filteredData.reduce((sum, item) => sum + item.amount, 0);
        const paid = filteredData
          .filter(item => item.status === 'Đã thanh toán')
          .reduce((sum, item) => sum + item.amount, 0);
        const pending = filteredData
          .filter(item => item.status === 'Chờ xử lý')
          .reduce((sum, item) => sum + item.amount, 0);
        
        const memberCount = new Set(filteredData.map(item => item.name)).size;
        const avg = memberCount > 0 ? Math.round(total / memberCount) : 0;
        
        // Animate numbers
        animateValue(totalSalaryEl, 0, total, 1000);
        animateValue(paidSalaryEl, 0, paid, 1000);
        animateValue(pendingSalaryEl, 0, pending, 1000);
        animateValue(avgSalaryEl, 0, avg, 1000);
      }
    
      // Animate number values
      function animateValue(element, start, end, duration) {
        const startTime = performance.now();
        const originalText = element.textContent;
        const suffix = originalText.includes('đ') ? 'đ' : '';
        
        function updateValue(time) {
          const elapsed = time - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const value = Math.floor(start + progress * (end - start));
          element.textContent = value.toLocaleString() + suffix;
          
          if (progress < 1) {
            requestAnimationFrame(updateValue);
          }
        }
        
        requestAnimationFrame(updateValue);
      }
    
      // Update pagination controls
      function updatePagination() {
        const totalPages = Math.ceil(filteredData.length / rowsPerPage);
        
        // Update pagination info
        const start = (currentPage - 1) * rowsPerPage + 1;
        const end = Math.min(currentPage * rowsPerPage, filteredData.length);
        paginationInfo.textContent = `Hiển thị ${start}-${end} của ${filteredData.length} bản ghi`;
        
        // Update page numbers
        pageNumbers.innerHTML = '';
        const maxVisiblePages = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
        
        if (endPage - startPage + 1 < maxVisiblePages) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }
        
        if (startPage > 1) {
          const firstPage = document.createElement('button');
          firstPage.className = 'page-number';
          firstPage.textContent = '1';
          firstPage.addEventListener('click', () => goToPage(1));
          pageNumbers.appendChild(firstPage);
          
          if (startPage > 2) {
            const ellipsis = document.createElement('span');
            ellipsis.className = 'page-ellipsis';
            ellipsis.textContent = '...';
            pageNumbers.appendChild(ellipsis);
          }
        }
        
        for (let i = startPage; i <= endPage; i++) {
          const pageBtn = document.createElement('button');
          pageBtn.className = `page-number ${i === currentPage ? 'active' : ''}`;
          pageBtn.textContent = i;
          pageBtn.addEventListener('click', () => goToPage(i));
          pageNumbers.appendChild(pageBtn);
        }
        
        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            const ellipsis = document.createElement('span');
            ellipsis.className = 'page-ellipsis';
            ellipsis.textContent = '...';
            pageNumbers.appendChild(ellipsis);
          }
          
          const lastPage = document.createElement('button');
          lastPage.className = 'page-number';
          lastPage.textContent = totalPages;
          lastPage.addEventListener('click', () => goToPage(totalPages));
          pageNumbers.appendChild(lastPage);
        }
        
        // Update button states
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
      }
    
      // Navigate to specific page
      function goToPage(page) {
        currentPage = page;
        renderTable();
        updatePagination();
        
        // Smooth scroll to top
        document.querySelector('.salary-table-container').scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    
      // Show payment modal
      function showPaymentModal(item, index) {
        document.getElementById('modalMemberName').textContent = item.name;
        document.getElementById('modalQuantity').textContent = item.quantity;
        document.getElementById('modalAmount').textContent = item.amount.toLocaleString() + 'đ';
        
        // Store the index of the item being processed
        paymentModal.setAttribute('data-index', index);
        
        // Show modal with animation
        paymentModal.style.display = 'flex';
        setTimeout(() => {
          paymentModal.querySelector('.modal-content').style.transform = 'translateY(0)';
          paymentModal.querySelector('.modal-content').style.opacity = '1';
        }, 10);
      }
    
      // Close payment modal
      function closePaymentModal() {
        paymentModal.querySelector('.modal-content').style.transform = 'translateY(-20px)';
        paymentModal.querySelector('.modal-content').style.opacity = '0';
        
        setTimeout(() => {
          paymentModal.style.display = 'none';
        }, 300);
      }
    
      // Get status badge class
      function getStatusClass(status) {
        switch (status) {
          case 'Đã thanh toán': return 'paid';
          case 'Chờ xử lý': return 'pending';
          case 'Đã hủy': return 'cancelled';
          default: return '';
        }
      }
    
      // Event listeners
      dateFilter.addEventListener('change', filterData);
      statusFilter.addEventListener('change', filterData);
      memberSearch.addEventListener('input', filterData);
      
      prevPageBtn.addEventListener('click', () => goToPage(currentPage - 1));
      nextPageBtn.addEventListener('click', () => goToPage(currentPage + 1));
      
      // Modal events
      document.querySelector('.close-modal').addEventListener('click', closePaymentModal);
      document.querySelector('.cancel-btn').addEventListener('click', closePaymentModal);
      
      document.querySelector('.confirm-btn').addEventListener('click', () => {
        const index = parseInt(paymentModal.getAttribute('data-index'));
        if (!isNaN(index) && index >= 0 && index < filteredData.length) {
          // Update status in the data
          filteredData[index].status = 'Đã thanh toán';
          
          // Update the table
          renderTable();
          updateSummary();
          
          // Close modal
          closePaymentModal();
          
          // Show success notification
          showNotification('Thanh toán thành công!', 'success');
        }
      });
      
      // Close modal when clicking outside
      paymentModal.addEventListener('click', (e) => {
        if (e.target === paymentModal) {
          closePaymentModal();
        }
      });
    
      // Export to Excel
      document.getElementById('exportExcel').addEventListener('click', () => {
        // In a real app, this would generate an Excel file
        showNotification('Chức năng xuất Excel đang được phát triển', 'info');
      });
    
      // Print report
      document.getElementById('printReport').addEventListener('click', () => {
        window.print();
      });
    
      // Show notification
      function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
          <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
          <span>${message}</span>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.classList.add('show');
        }, 10);
        
        setTimeout(() => {
          notification.classList.remove('show');
          setTimeout(() => {
            notification.remove();
          }, 300);
        }, 3000);
      }
    });
    </script>
    
</body>
</html>